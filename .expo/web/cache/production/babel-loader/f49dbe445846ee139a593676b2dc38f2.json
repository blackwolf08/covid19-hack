{"ast":null,"code":"import _regeneratorRuntime from\"@babel/runtime/regenerator\";function _createForOfIteratorHelperLoose(o){var i=0;if(typeof Symbol===\"undefined\"||o[typeof Symbol===\"function\"?Symbol.iterator:\"@@iterator\"]==null){if(Array.isArray(o)||(o=_unsupportedIterableToArray(o)))return function(){if(i>=o.length)return{done:true};return{done:false,value:o[i++]};};throw new TypeError(\"Invalid attempt to iterate non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.\");}i=o[typeof Symbol===\"function\"?Symbol.iterator:\"@@iterator\"]();return i.next.bind(i);}function _unsupportedIterableToArray(o,minLen){if(!o)return;if(typeof o===\"string\")return _arrayLikeToArray(o,minLen);var n=Object.prototype.toString.call(o).slice(8,-1);if(n===\"Object\"&&o.constructor)n=o.constructor.name;if(n===\"Map\"||n===\"Set\")return Array.from(n);if(n===\"Arguments\"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return _arrayLikeToArray(o,minLen);}function _arrayLikeToArray(arr,len){if(len==null||len>arr.length)len=arr.length;for(var i=0,arr2=new Array(len);i<len;i++){arr2[i]=arr[i];}return arr2;}import{PermissionStatus}from\"./Permissions.types\";function _getUserMedia(constraints){if(navigator.mediaDevices&&navigator.mediaDevices.getUserMedia){return navigator.mediaDevices.getUserMedia(constraints);}var getUserMedia=navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia||function(){var error=new Error('Permission unimplemented');error.code=0;error.name='NotAllowedError';throw error;};return new Promise(function(resolve,reject){getUserMedia.call(navigator,constraints,resolve,reject);});}function askForMediaPermissionAsync(options){var message;return _regeneratorRuntime.async(function askForMediaPermissionAsync$(_context){while(1){switch(_context.prev=_context.next){case 0:_context.prev=0;_context.next=3;return _regeneratorRuntime.awrap(_getUserMedia(options));case 3:return _context.abrupt(\"return\",{status:PermissionStatus.GRANTED,expires:'never',canAskAgain:true,granted:true});case 6:_context.prev=6;_context.t0=_context[\"catch\"](0);message=_context.t0.message;if(!(message==='Permission dismissed')){_context.next=13;break;}return _context.abrupt(\"return\",{status:PermissionStatus.UNDETERMINED,expires:'never',canAskAgain:true,granted:false});case 13:return _context.abrupt(\"return\",{status:PermissionStatus.DENIED,expires:'never',canAskAgain:true,granted:false});case 14:case\"end\":return _context.stop();}}},null,null,[[0,6]],Promise);}function askForMicrophonePermissionAsync(){return _regeneratorRuntime.async(function askForMicrophonePermissionAsync$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:_context2.next=2;return _regeneratorRuntime.awrap(askForMediaPermissionAsync({audio:true}));case 2:return _context2.abrupt(\"return\",_context2.sent);case 3:case\"end\":return _context2.stop();}}},null,null,null,Promise);}function askForCameraPermissionAsync(){return _regeneratorRuntime.async(function askForCameraPermissionAsync$(_context3){while(1){switch(_context3.prev=_context3.next){case 0:_context3.next=2;return _regeneratorRuntime.awrap(askForMediaPermissionAsync({video:true}));case 2:return _context3.abrupt(\"return\",_context3.sent);case 3:case\"end\":return _context3.stop();}}},null,null,null,Promise);}function askForLocationPermissionAsync(){return _regeneratorRuntime.async(function askForLocationPermissionAsync$(_context4){while(1){switch(_context4.prev=_context4.next){case 0:return _context4.abrupt(\"return\",new Promise(function(resolve){navigator.geolocation.getCurrentPosition(function(){return resolve({status:PermissionStatus.GRANTED,expires:'never',canAskAgain:true,granted:true});},function(_ref2){var code=_ref2.code;if(code===1){resolve({status:PermissionStatus.DENIED,expires:'never',canAskAgain:true,granted:false});}else{resolve({status:PermissionStatus.UNDETERMINED,expires:'never',canAskAgain:true,granted:false});}});}));case 1:case\"end\":return _context4.stop();}}},null,null,null,Promise);}function getPermissionWithQueryAsync(name){var _await$navigator$perm,state;return _regeneratorRuntime.async(function getPermissionWithQueryAsync$(_context5){while(1){switch(_context5.prev=_context5.next){case 0:if(!(!navigator||!navigator.permissions||!navigator.permissions.query)){_context5.next=2;break;}return _context5.abrupt(\"return\",null);case 2:_context5.next=4;return _regeneratorRuntime.awrap(navigator.permissions.query({name:name}));case 4:_await$navigator$perm=_context5.sent;state=_await$navigator$perm.state;if(!(state==='prompt')){_context5.next=10;break;}return _context5.abrupt(\"return\",PermissionStatus.UNDETERMINED);case 10:if(!(state==='granted')){_context5.next=14;break;}return _context5.abrupt(\"return\",PermissionStatus.GRANTED);case 14:if(!(state==='denied')){_context5.next=16;break;}return _context5.abrupt(\"return\",PermissionStatus.DENIED);case 16:return _context5.abrupt(\"return\",null);case 17:case\"end\":return _context5.stop();}}},null,null,null,Promise);}function enumerateDevices(){return _regeneratorRuntime.async(function enumerateDevices$(_context6){while(1){switch(_context6.prev=_context6.next){case 0:if(!(navigator&&navigator.mediaDevices&&navigator.mediaDevices.enumerateDevices)){_context6.next=4;break;}_context6.next=3;return _regeneratorRuntime.awrap(navigator.mediaDevices.enumerateDevices());case 3:return _context6.abrupt(\"return\",_context6.sent);case 4:if(!(window.MediaStreamTrack&&typeof window.MediaStreamTrack.getSources==='function')){_context6.next=8;break;}_context6.next=7;return _regeneratorRuntime.awrap(MediaStreamTrack.getSources());case 7:return _context6.abrupt(\"return\",_context6.sent);case 8:return _context6.abrupt(\"return\",null);case 9:case\"end\":return _context6.stop();}}},null,null,null,Promise);}function getMediaMaybeGrantedAsync(targetKind){var devices,result;return _regeneratorRuntime.async(function getMediaMaybeGrantedAsync$(_context7){while(1){switch(_context7.prev=_context7.next){case 0:_context7.next=2;return _regeneratorRuntime.awrap(enumerateDevices());case 2:devices=_context7.sent;if(devices){_context7.next=5;break;}return _context7.abrupt(\"return\",false);case 5:_context7.next=7;return _regeneratorRuntime.awrap(devices.filter(function(_ref3){var kind=_ref3.kind;return kind===targetKind;}).some(function(_ref4){var label=_ref4.label;return label!=='';}));case 7:result=_context7.sent;return _context7.abrupt(\"return\",result);case 9:case\"end\":return _context7.stop();}}},null,null,null,Promise);}function getPermissionAsync(permission,shouldAsk){var status,_window,_window$Notification,Notification,_status,maybeStatus,_maybeStatus,maybeGranted,_maybeStatus2,_maybeGranted;return _regeneratorRuntime.async(function getPermissionAsync$(_context8){while(1){switch(_context8.prev=_context8.next){case 0:_context8.t0=permission;_context8.next=_context8.t0==='userFacingNotifications'?3:_context8.t0==='notifications'?3:_context8.t0==='location'?20:_context8.t0==='audioRecording'?36:_context8.t0==='camera'?59:82;break;case 3:if(shouldAsk){_context8.next=9;break;}_context8.next=6;return _regeneratorRuntime.awrap(getPermissionWithQueryAsync('notifications'));case 6:status=_context8.sent;if(!status){_context8.next=9;break;}return _context8.abrupt(\"return\",{status:status,expires:'never',granted:status===PermissionStatus.GRANTED,canAskAgain:true});case 9:_window=window,_window$Notification=_window.Notification,Notification=_window$Notification===void 0?{}:_window$Notification;if(!Notification.requestPermission){_context8.next=19;break;}_status=Notification.permission;if(!shouldAsk){_context8.next=16;break;}_context8.next=15;return _regeneratorRuntime.awrap(Notification.requestPermission());case 15:_status=_context8.sent;case 16:if(!(!_status||_status==='default')){_context8.next=18;break;}return _context8.abrupt(\"return\",{status:PermissionStatus.UNDETERMINED,expires:'never',canAskAgain:true,granted:false});case 18:return _context8.abrupt(\"return\",{status:_status,expires:'never',canAskAgain:true,granted:_status===PermissionStatus.GRANTED});case 19:return _context8.abrupt(\"break\",83);case 20:_context8.next=22;return _regeneratorRuntime.awrap(getPermissionWithQueryAsync('geolocation'));case 22:maybeStatus=_context8.sent;if(!maybeStatus){_context8.next=31;break;}if(!(maybeStatus===PermissionStatus.UNDETERMINED&&shouldAsk)){_context8.next=28;break;}_context8.next=27;return _regeneratorRuntime.awrap(askForLocationPermissionAsync());case 27:return _context8.abrupt(\"return\",_context8.sent);case 28:return _context8.abrupt(\"return\",{status:maybeStatus,expires:'never',canAskAgain:true,granted:maybeStatus===PermissionStatus.GRANTED});case 31:if(!shouldAsk){_context8.next=35;break;}_context8.next=34;return _regeneratorRuntime.awrap(askForLocationPermissionAsync());case 34:return _context8.abrupt(\"return\",_context8.sent);case 35:return _context8.abrupt(\"break\",83);case 36:_context8.next=38;return _regeneratorRuntime.awrap(getPermissionWithQueryAsync('microphone'));case 38:_maybeStatus=_context8.sent;if(!_maybeStatus){_context8.next=47;break;}if(!(_maybeStatus===PermissionStatus.UNDETERMINED&&shouldAsk)){_context8.next=44;break;}_context8.next=43;return _regeneratorRuntime.awrap(askForMicrophonePermissionAsync());case 43:return _context8.abrupt(\"return\",_context8.sent);case 44:return _context8.abrupt(\"return\",{status:_maybeStatus,expires:'never',canAskAgain:true,granted:_maybeStatus===PermissionStatus.GRANTED});case 47:if(!shouldAsk){_context8.next=53;break;}_context8.next=50;return _regeneratorRuntime.awrap(askForMicrophonePermissionAsync());case 50:return _context8.abrupt(\"return\",_context8.sent);case 53:_context8.next=55;return _regeneratorRuntime.awrap(getMediaMaybeGrantedAsync('audioinput'));case 55:maybeGranted=_context8.sent;if(!maybeGranted){_context8.next=58;break;}return _context8.abrupt(\"return\",{status:PermissionStatus.GRANTED,expires:'never',canAskAgain:true,granted:true});case 58:return _context8.abrupt(\"break\",83);case 59:_context8.next=61;return _regeneratorRuntime.awrap(getPermissionWithQueryAsync('camera'));case 61:_maybeStatus2=_context8.sent;if(!_maybeStatus2){_context8.next=70;break;}if(!(_maybeStatus2===PermissionStatus.UNDETERMINED&&shouldAsk)){_context8.next=67;break;}_context8.next=66;return _regeneratorRuntime.awrap(askForCameraPermissionAsync());case 66:return _context8.abrupt(\"return\",_context8.sent);case 67:return _context8.abrupt(\"return\",{status:_maybeStatus2,expires:'never',canAskAgain:true,granted:_maybeStatus2===PermissionStatus.GRANTED});case 70:if(!shouldAsk){_context8.next=76;break;}_context8.next=73;return _regeneratorRuntime.awrap(askForCameraPermissionAsync());case 73:return _context8.abrupt(\"return\",_context8.sent);case 76:_context8.next=78;return _regeneratorRuntime.awrap(getMediaMaybeGrantedAsync('videoinput'));case 78:_maybeGranted=_context8.sent;if(!_maybeGranted){_context8.next=81;break;}return _context8.abrupt(\"return\",{status:PermissionStatus.GRANTED,expires:'never',canAskAgain:true,granted:true});case 81:return _context8.abrupt(\"break\",83);case 82:return _context8.abrupt(\"break\",83);case 83:return _context8.abrupt(\"return\",{status:PermissionStatus.UNDETERMINED,expires:'never',canAskAgain:true,granted:false});case 84:case\"end\":return _context8.stop();}}},null,null,null,Promise);}export default{get name(){return'ExpoPermissions';},getAsync:function getAsync(permissionTypes){var results,_iterator,_step,permissionType;return _regeneratorRuntime.async(function getAsync$(_context9){while(1){switch(_context9.prev=_context9.next){case 0:results={};_iterator=_createForOfIteratorHelperLoose(new Set(permissionTypes));case 2:if((_step=_iterator()).done){_context9.next=9;break;}permissionType=_step.value;_context9.next=6;return _regeneratorRuntime.awrap(getPermissionAsync(permissionType,false));case 6:results[permissionType]=_context9.sent;case 7:_context9.next=2;break;case 9:return _context9.abrupt(\"return\",results);case 10:case\"end\":return _context9.stop();}}},null,null,null,Promise);},askAsync:function askAsync(permissionTypes){var results,_iterator2,_step2,permissionType;return _regeneratorRuntime.async(function askAsync$(_context10){while(1){switch(_context10.prev=_context10.next){case 0:results={};_iterator2=_createForOfIteratorHelperLoose(new Set(permissionTypes));case 2:if((_step2=_iterator2()).done){_context10.next=9;break;}permissionType=_step2.value;_context10.next=6;return _regeneratorRuntime.awrap(getPermissionAsync(permissionType,true));case 6:results[permissionType]=_context10.sent;case 7:_context10.next=2;break;case 9:return _context10.abrupt(\"return\",results);case 10:case\"end\":return _context10.stop();}}},null,null,null,Promise);}};","map":{"version":3,"sources":["../src/ExpoPermissions.web.ts"],"names":[],"mappings":"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","sourcesContent":["import {\n  PermissionMap,\n  PermissionType,\n  PermissionStatus,\n  PermissionInfo,\n} from './Permissions.types';\n\n/*\n * TODO: Bacon: https://developer.mozilla.org/en-US/docs/Web/API/MediaDevices/getUserMedia#Permissions\n * Add messages to manifest like we do with iOS info.plist\n */\n\n// https://developer.mozilla.org/en-US/docs/Web/API/MediaDevices/getUserMedia#Using_the_new_API_in_older_browsers\n// Older browsers might not implement mediaDevices at all, so we set an empty object first\nfunction _getUserMedia(constraints: MediaStreamConstraints): Promise<MediaStream> {\n  if (navigator.mediaDevices && navigator.mediaDevices.getUserMedia) {\n    return navigator.mediaDevices.getUserMedia(constraints);\n  }\n\n  // Some browsers partially implement mediaDevices. We can't just assign an object\n  // with getUserMedia as it would overwrite existing properties.\n  // Here, we will just add the getUserMedia property if it's missing.\n\n  // First get ahold of the legacy getUserMedia, if present\n  const getUserMedia =\n    navigator.getUserMedia ||\n    (navigator as any).webkitGetUserMedia ||\n    (navigator as any).mozGetUserMedia ||\n    function() {\n      const error: any = new Error('Permission unimplemented');\n      error.code = 0;\n      error.name = 'NotAllowedError';\n      throw error;\n    };\n\n  return new Promise((resolve, reject) => {\n    getUserMedia.call(navigator, constraints, resolve, reject);\n  });\n}\n\nasync function askForMediaPermissionAsync(\n  options: MediaStreamConstraints\n): Promise<PermissionInfo> {\n  try {\n    await _getUserMedia(options);\n    return {\n      status: PermissionStatus.GRANTED,\n      expires: 'never',\n      canAskAgain: true,\n      granted: true,\n    };\n  } catch ({ message }) {\n    // name: NotAllowedError\n    // code: 0\n    if (message === 'Permission dismissed') {\n      // message: Permission dismissed\n      return {\n        status: PermissionStatus.UNDETERMINED,\n        expires: 'never',\n        canAskAgain: true,\n        granted: false,\n      };\n    } else {\n      // TODO: Bacon: [OSX] The system could deny access to chrome.\n      // TODO: Bacon: add: { status: 'unimplemented' }\n      // message: Permission denied\n      return {\n        status: PermissionStatus.DENIED,\n        expires: 'never',\n        canAskAgain: true,\n        granted: false,\n      };\n    }\n  }\n}\n\nasync function askForMicrophonePermissionAsync(): Promise<PermissionInfo> {\n  return await askForMediaPermissionAsync({ audio: true });\n}\n\nasync function askForCameraPermissionAsync(): Promise<PermissionInfo> {\n  return await askForMediaPermissionAsync({ video: true });\n}\n\nasync function askForLocationPermissionAsync(): Promise<PermissionInfo> {\n  return new Promise(resolve => {\n    navigator.geolocation.getCurrentPosition(\n      () =>\n        resolve({\n          status: PermissionStatus.GRANTED,\n          expires: 'never',\n          canAskAgain: true,\n          granted: true,\n        }),\n      ({ code }: PositionError) => {\n        // https://developer.mozilla.org/en-US/docs/Web/API/PositionError/code\n        if (code === 1) {\n          resolve({\n            status: PermissionStatus.DENIED,\n            expires: 'never',\n            canAskAgain: true,\n            granted: false,\n          });\n        } else {\n          resolve({\n            status: PermissionStatus.UNDETERMINED,\n            expires: 'never',\n            canAskAgain: true,\n            granted: false,\n          });\n        }\n      }\n    );\n  });\n}\n\nasync function getPermissionWithQueryAsync(name: PermissionName): Promise<PermissionStatus | null> {\n  if (!navigator || !navigator.permissions || !navigator.permissions.query) return null;\n\n  const { state } = await navigator.permissions.query({ name });\n  if (state === 'prompt') {\n    return PermissionStatus.UNDETERMINED;\n  } else if (state === 'granted') {\n    return PermissionStatus.GRANTED;\n  } else if (state === 'denied') {\n    return PermissionStatus.DENIED;\n  }\n  return null;\n}\n\nasync function enumerateDevices(): Promise<MediaDeviceInfo[] | null> {\n  if (navigator && navigator.mediaDevices && navigator.mediaDevices.enumerateDevices) {\n    return await navigator.mediaDevices.enumerateDevices();\n  }\n\n  // @ts-ignore: This is deprecated but we should still attempt to use it.\n  if (window.MediaStreamTrack && typeof window.MediaStreamTrack.getSources === 'function') {\n    // @ts-ignore\n    return await MediaStreamTrack.getSources();\n  }\n  return null;\n}\n\nasync function getMediaMaybeGrantedAsync(targetKind: MediaDeviceKind): Promise<boolean> {\n  const devices = await enumerateDevices();\n  if (!devices) {\n    return false;\n  }\n  const result = await devices\n    .filter(({ kind }) => kind === targetKind)\n    .some(({ label }) => label !== '');\n  // Granted or denied or undetermined or no devices\n  return result;\n}\n\nasync function getPermissionAsync(\n  permission: PermissionType,\n  shouldAsk: boolean\n): Promise<PermissionInfo> {\n  switch (permission) {\n    case 'userFacingNotifications':\n    case 'notifications':\n      {\n        if (!shouldAsk) {\n          const status = await getPermissionWithQueryAsync('notifications');\n          if (status) {\n            return {\n              status,\n              expires: 'never',\n              granted: status === PermissionStatus.GRANTED,\n              canAskAgain: true,\n            };\n          }\n        }\n\n        const { Notification = {} } = window as any;\n        if (Notification.requestPermission) {\n          let status = Notification.permission;\n          if (shouldAsk) {\n            status = await Notification.requestPermission();\n          }\n          if (!status || status === 'default') {\n            return {\n              status: PermissionStatus.UNDETERMINED,\n              expires: 'never',\n              canAskAgain: true,\n              granted: false,\n            };\n          }\n          return {\n            status,\n            expires: 'never',\n            canAskAgain: true,\n            granted: status === PermissionStatus.GRANTED,\n          };\n        }\n      }\n      break;\n    case 'location':\n      {\n        const maybeStatus = await getPermissionWithQueryAsync('geolocation');\n        if (maybeStatus) {\n          if (maybeStatus === PermissionStatus.UNDETERMINED && shouldAsk) {\n            return await askForLocationPermissionAsync();\n          }\n          return {\n            status: maybeStatus,\n            expires: 'never',\n            canAskAgain: true,\n            granted: maybeStatus === PermissionStatus.GRANTED,\n          };\n        } else if (shouldAsk) {\n          // TODO: Bacon: should this function as ask async when not in chrome?\n          return await askForLocationPermissionAsync();\n        }\n      }\n      break;\n    case 'audioRecording':\n      {\n        const maybeStatus = await getPermissionWithQueryAsync('microphone');\n        if (maybeStatus) {\n          if (maybeStatus === PermissionStatus.UNDETERMINED && shouldAsk) {\n            return await askForMicrophonePermissionAsync();\n          }\n          return {\n            status: maybeStatus,\n            expires: 'never',\n            canAskAgain: true,\n            granted: maybeStatus === PermissionStatus.GRANTED,\n          };\n        } else if (shouldAsk) {\n          return await askForMicrophonePermissionAsync();\n        } else {\n          const maybeGranted = await getMediaMaybeGrantedAsync('audioinput');\n          if (maybeGranted) {\n            return {\n              status: PermissionStatus.GRANTED,\n              expires: 'never',\n              canAskAgain: true,\n              granted: true,\n            };\n          }\n          // TODO: Bacon: Get denied or undetermined...\n        }\n      }\n      break;\n    case 'camera':\n      {\n        const maybeStatus = await getPermissionWithQueryAsync('camera');\n        if (maybeStatus) {\n          if (maybeStatus === PermissionStatus.UNDETERMINED && shouldAsk) {\n            return await askForCameraPermissionAsync();\n          }\n          return {\n            status: maybeStatus,\n            expires: 'never',\n            canAskAgain: true,\n            granted: maybeStatus === PermissionStatus.GRANTED,\n          };\n        } else if (shouldAsk) {\n          return await askForCameraPermissionAsync();\n        } else {\n          const maybeGranted = await getMediaMaybeGrantedAsync('videoinput');\n          if (maybeGranted) {\n            return {\n              status: PermissionStatus.GRANTED,\n              expires: 'never',\n              canAskAgain: true,\n              granted: true,\n            };\n          }\n          // TODO: Bacon: Get denied or undetermined...\n        }\n      }\n      break;\n    default:\n      break;\n  }\n  return {\n    status: PermissionStatus.UNDETERMINED,\n    expires: 'never',\n    canAskAgain: true,\n    granted: false,\n  };\n}\n\nexport default {\n  get name(): string {\n    return 'ExpoPermissions';\n  },\n\n  async getAsync(permissionTypes: PermissionType[]): Promise<PermissionMap> {\n    const results = {};\n    for (const permissionType of new Set(permissionTypes)) {\n      results[permissionType] = await getPermissionAsync(permissionType, /* shouldAsk */ false);\n    }\n    return results;\n  },\n\n  async askAsync(permissionTypes: PermissionType[]): Promise<PermissionMap> {\n    const results = {};\n    for (const permissionType of new Set(permissionTypes)) {\n      results[permissionType] = await getPermissionAsync(permissionType, /* shouldAsk */ true);\n    }\n    return results;\n  },\n};\n"],"sourceRoot":""},"metadata":{},"sourceType":"module"}